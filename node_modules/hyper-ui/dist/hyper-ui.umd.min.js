!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).HUI=t()}(this,function(){"use strict";var e=document,t=Object,n=Array,r=Symbol,o=Boolean,c=Map,i=Node,f=console,s=t.assign,a=t.is,u=t.keys,l=n.isArray,p=n.from,d=n.prototype,h=d.splice,v=d.push,g=d.indexOf,y=new c,m=function define(e,t){var n=r(e);return y.set(n,t),n};function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var w=function toArr(e){return l(e)?e:[e]},x=function toFrag(t){return t.reduce(function(e,t){return e.appendChild(t),e},e.createDocumentFragment())},b=function isHNode(e){return e&&"object"===_typeof(e)&&e.isHNode},N=function replaceNodes(e,t,n){t.forEach(function(t,r){r?e.removeChild(t):e.replaceChild(x(n),t)})},_=function inherit(e,t){e.nodes=t.nodes,e.owner=t.owner,e.ownerNode=t.ownerNode,e.context=t.context,e.store=t.store,t.desc?e.output=t.output:e.events=t.events},E=[],C=function render(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.parent,o=void 0===r?e.body:r,c=n.context,i=void 0===c?B():c,f=n.clear,s=n.owner;n.sync?(f&&p(o.childNodes).forEach(function(e){o.removeChild(e)}),o.appendChild(x(D(t,i,o,s)))):(E.push(function(){render(t,{parent:o,owner:s,context:i,clear:f,sync:!0})}),W())},A=["children"];function patch(e,t,n,r,o){var c,i;o.forEach(function(o){c=n[o],i=r[o],!A.includes(o)&&J.cmp(c,i)||k(e,t,o,c,i)})}var H=function clear(e){var t=e.desc,n=e.output;if(e.active=!1,t){if(t.clear)try{t.clear.call(e,e.props,e.store,e.context)}catch(e){f.error(e)}}else{var r=e.props.ref;r&&r()}var o=O.indexOf(e);~o&&O.splice(o,1),n&&n.forEach(function(e){b(e)&&clear(e)})},S=new c([["children",function(e,t,n,r){!function updateChildren(e,t,n,r){var o,c,i,f,s,a,l=e.childNodes,p=r.length,d=0;r.forEach(function(r,p){if(i=n[p]){if(b(r)){if(c=r.nodes,b(i)&&i.type===r.type){if(f=c,r.desc)return _(i,r),d+=f.length,q(i);if(a=u(s=i.props),u(o=r.props).every(function(e){return a.includes(e)}))return _(i,r),d++,patch(f[0],i,s,o,a)}H(r)}else{if(J.cmp(r,i))return d++;c=l.length?[l[d]]:[]}d+=(f=D(i,t.context,e,t)).length,c.length?N(e,c,f):e.appendChild(x(f))}else b(r)?(H(r),r.nodes.forEach(function(t){e.removeChild(t)})):l.length&&e.removeChild(l[d++])}),p<n.length&&C(n.slice(p),{parent:e,owner:t,context:t.context})}(e,r,t,n||[])}],["style",function(e,t){if(t&&"object"===_typeof(t))s(e.style,t);else try{e.style=t}catch(n){e.setAttribute("style",t)}}],["class",function(e,t){e.setAttribute("class",l(t)?t.filter(o).join(" "):t)}],["ref",function(e,t){t(e)}],["attr",function(e,t){u(t).forEach(function(n){e.setAttribute(n,t[n])})}],["prop",function(e,t){s(e,t)}]]),k=function handleProp(e,t,n,r,o){var c=S.get(n);if(c)c(e,r,o,t);else if(n.startsWith("on")){var i=t.events,f=i.get(n);f&&e.removeEventListener(f[0],f[1],f[2]),i.set(n,function listen(e,t,n){for(var r=!1,o=!0,c=!1,i=0;i<3;i++)t.endsWith("Captrue")?(r=!0,t=t.slice(0,-7)):t.endsWith("Nonpassive")?(o=!1,t=t.slice(0,-10)):t.endsWith("Once")&&(c=!0,t=t.slice(0,-4));var f=(r||!o||c)&&{capture:r,passive:o,once:c};return e.addEventListener(t,n,f),[t,n,f]}(e,n.slice(2),r))}else if(n in e)try{e[n]=r}catch(t){e.setAttribute(n,r)}else e.setAttribute(n,r)},j=function handleError(e,t){var n,r=t.owner;if(!r)throw e;for(;(!(n=r.desc)||!n.catch)&&r.owner;)r=r.owner;r.error=e,q(r)},D=function toNodes(t,n,r,o){var i=_typeof(t);if("string"===i)return[e.createTextNode(t)];if("number"===i)return[e.createTextNode(t+"")];if(t){if(l(t)&&t.length)return t.flat(1/0).map(function(e){return toNodes(e,n,r,o)}).flat();if(b(t)){var f=t.type,s=t.desc,a=t.props;if(t.ownerNode=r,t.owner=o,!s){t.events=new c;var p=a.xmlns?e.createElementNS(a.xmlns,f):e.createElement(f);return u(a).forEach(function(e){k(p,t,e,a[e])}),t.output=[],t.nodes=[p],[p]}var d=t.store=B();s.state&&t.store.bind(t,s.state),t.context=n,s.context&&n.bind(t,s.context);try{return t.active=!1,s.init&&s.init.call(t,a,d,n),t.nodes=toNodes(t.output=w(s.render.call(t,a,d,n)).flat(1/0),n,r,t)}catch(e){if(s.catch)return t.nodes=toNodes(t.output=w(s.catch.call(t,e,a,d,n)).flat(1/0),n,r,t);j(e,t)}finally{t.active=!0}}}return[e.createTextNode("")]},F=function updateComponent(e){var t=e.desc,n=e.output,r=e.nodes,o=e.owner,c=e.ownerNode,i=e.context,f=e.props,s=e.store,a=e.error,l=n.length,p=o&&o.nodes,d=[].concat(r);try{if(e.active=!1,a)throw e.error=void 0,a;var y,m,E,C,A,S,k,F,O=c.childNodes,I=0;(e.output=w(t.render.call(e,f,s,i)).flat(1/0)).forEach(function(t,o){if(o<l){if(y=n[o],C=1,b(y)){if(C=(E=y.nodes).length,b(t)&&y.type===t.type){if(y.desc)return _(t,y),q(t),void(I+=t.nodes.length);if(k=u(S=t.props),u(m=y.props).every(function(e){return k.includes(e)}))return I++,_(t,y),patch(E[0],t,S,m,k)}H(y)}else if(!b(t)&&J.cmp(y,t))return;A=D(t,i,c,e),E=h.apply(d,[d.indexOf(r[I]),C].concat(A)),I+=C,N(c,E,A)}else o===l&&(F=O[g.call(O,d[d.length-1])+1]||null),v.apply(d,A=D(t,i,c,e)),c.insertBefore(x(A),F)})}catch(o){t.catch?(d=D(e.output=w(t.catch.call(e,o,f,s,i)),i,c,e),N(c,r,d),n.forEach(function(e){b(e)&&H(e)})):j(o,e)}finally{e.active=!0}if(p)for(var U=r[0],L=[r.length].concat(d),P=o,T=p;P;)T=P.nodes,h.apply(T,[T.indexOf(U)].concat(L)),P=P.owner;e.nodes=d},O=[],I=[],U=[],L=!1,P=function ticker(){L=!1;var e,t,n=Date.now()+J.frameLimit;for(t=0;t<O.length;t++)if(e=O[t]){O[t]=void 0;try{F(e)}catch(e){throw O.splice(0,t+1),e}if(Date.now()>=n)return O.splice(0,t+1),T()}for(O.length=0,t=0;t<U.length;t++)if(U[t](),Date.now()>=n)return U.splice(0,t+1),T();for(U.length=0,t=0;t<E.length;t++)if(E[t](),Date.now()>=n)return E.splice(0,t+1),T();for(E.length=0,t=0;t<I.length;t++)if(I[t](),Date.now()>=n)return I.splice(0,t+1),T();I.length=0},T=function tick(){J.tick(P),L=!0},W=function reqTick(){L||T()},q=function mark(e){O.includes(e)||(W(),O.push(e))},B=function createStore(){var e=new c,t=new c,n=new c,r={map:e,bind:function bind(e,n){return n.forEach(function(n){t.has(n)?t.get(n).push(e):t.set(n,[e])}),this},get:function store_get(t){return e.get(t)},set:function store_set(n,o,c){return!c&&J.cmp(o,r.get(n))||(e.set(n,o),t.has(n)&&t.get(n).forEach(function(e){e.active&&q(e)})),r},setter:function store_setter(e,t){var o=+!t;if(n.has(e)){var c=n.get(e),i=c[o];return i||(c[o]=function setter(n){r.set(e,n,t)})}var f=[];return n.set(e,f),f[o]=function setter(n){r.set(e,n,t)}},toggle:function store_toggle(e){return r.set(e,!r.get(e))},inc:function store_inc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return r.set(e,r.get(e)+t)},push:function store_push(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return r.set(e,r.get(e).concat(n))},unshift:function store_unshift(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return r.set(e,n.concat(r.get(e)))},slice:function store_slice(e,t,n){return r.set(e,r.get(e).slice(t,n))},splice:function store_splice(e,t,n){for(var o=r.get(e).slice(),c=arguments.length,i=Array(c>3?c-3:0),f=3;f<c;f++)i[f-3]=arguments[f];return h.apply(o,[t,n].concat(i)),r.set(e,o)}};return r},M=m("HUI.Portal",{init:function portal_init(t,n){n.set("parent",t.parent||e.body),n.set("fragment",J(J.Fragment,null,t.children))},render:function portal_render(e,t,n){C(t.get("fragment"),{parent:t.get("parent"),owner:this,context:n})},clear:function portal_clear(e,t){var n=t.get("fragment"),r=n.ownerNode,o=n.nodes;H(n),o.forEach(function(e){r.removeChild(e)}),o.length=0}}),z=m("HUI.Context",{init:function context_init(e,t,n){n.set(e.key,e.value)},render:function context_render(e){return e.children}}),G=m("HUI.Fragment",{render:function fragment_render(e){return e.children}}),J=function HUI(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return{isHNode:!0,type:e,desc:y.get(e),props:s({children:r.flat(1/0)},t),active:!0}};return J.registry=y,J.define=m,J.createStore=B,J.propHandlers=S,J.noCmpProps=A,J.render=C,J.tick=function(e){requestAnimationFrame(e)},J.frameLimit=15,J.defer=function defer(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];I.push(function(){e.apply(void 0,n)}),W()},J.Portal=M,J.Context=z,J.Fragment=G,J.cmp=function cmp(e,t){if(a(e,t))return!0;if(l(e))return l(t)&&e.length===t.length&&e.every(function(e,n){return cmp(t[n],e)});if(e&&t&&"object"===_typeof(e)&&"object"===_typeof(t)){if(e.isHNode)return t.isHNode&&e.type===t.type&&cmp(e.props,t.props);if(!(e instanceof i||t instanceof i)){var n=u(e),r=u(t);return n.length===r.length&&n.every(function(n){return r.includes(n)&&cmp(e[n],t[n])})}}return!1},J});