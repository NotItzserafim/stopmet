const e=document,t=Object,n=Array,r=Symbol,o=Boolean,c=Map,i=Node,s=console,{assign:l,is:f,keys:a}=t,{isArray:u,from:p}=n,{splice:d,push:h,indexOf:g}=n.prototype,y=new c,m=function(e,t){const n=r(e);return y.set(n,t),n},w=e=>u(e)?e:[e],v=t=>t.reduce((e,t)=>(e.appendChild(t),e),e.createDocumentFragment()),x=e=>e&&"object"==typeof e&&e.isHNode,N=function(e,t,n){t.forEach((t,r)=>{r?e.removeChild(t):e.replaceChild(v(n),t)})},b=function(e,t){e.nodes=t.nodes,e.owner=t.owner,e.ownerNode=t.ownerNode,e.context=t.context,e.store=t.store,t.desc?e.output=t.output:e.events=t.events},E=[],_=function(t,n={}){const{parent:r=e.body,context:o=B(),clear:c,owner:i}=n;n.sync?(c&&p(r.childNodes).forEach(e=>{r.removeChild(e)}),r.appendChild(v(O(t,o,r,i)))):(E.push(()=>{_(t,{parent:r,owner:i,context:o,clear:c,sync:!0})}),T())},C=["children"];function patch(e,t,n,r,o){let c,i;o.forEach(o=>{c=n[o],i=r[o],!C.includes(o)&&J.cmp(c,i)||j(e,t,o,c,i)})}const A=function(e){const{desc:t,output:n}=e;if(e.active=!1,t){if(t.clear)try{t.clear.call(e,e.props,e.store,e.context)}catch(e){s.error(e)}}else{const{ref:t}=e.props;t&&t()}const r=k.indexOf(e);~r&&k.splice(r,1),n&&n.forEach(e=>{x(e)&&A(e)})},H=new c([["children",function(e,t,n,r){!function(e,t,n,r){const{childNodes:o}=e,c=r.length;let i,s,l,f,u,p,d=0;r.forEach((r,c)=>{if(l=n[c]){if(x(r)){if(s=r.nodes,x(l)&&l.type===r.type){if(f=s,r.desc)return b(l,r),d+=f.length,U(l);if(p=a(u=l.props),a(i=r.props).every(e=>p.includes(e)))return b(l,r),d++,patch(f[0],l,u,i,p)}A(r)}else{if(J.cmp(r,l))return d++;s=o.length?[o[d]]:[]}d+=(f=O(l,t.context,e,t)).length,s.length?N(e,s,f):e.appendChild(v(f))}else x(r)?(A(r),r.nodes.forEach(t=>{e.removeChild(t)})):o.length&&e.removeChild(o[d++])}),c<n.length&&_(n.slice(c),{parent:e,owner:t,context:t.context})}(e,r,t,n||[])}],["style",function(e,t){if(t&&"object"==typeof t)l(e.style,t);else try{e.style=t}catch{e.setAttribute("style",t)}}],["class",function(e,t){e.setAttribute("class",u(t)?t.filter(o).join(" "):t)}],["ref",function(e,t){t(e)}],["attr",function(e,t){a(t).forEach(n=>{e.setAttribute(n,t[n])})}],["prop",function(e,t){l(e,t)}]]),j=function(e,t,n,r,o){const c=H.get(n);if(c)c(e,r,o,t);else if(n.startsWith("on")){const{events:o}=t,c=o.get(n);c&&e.removeEventListener(c[0],c[1],c[2]),o.set(n,function(e,t,n){let r=!1,o=!0,c=!1;for(let e=0;e<3;e++)t.endsWith("Captrue")?(r=!0,t=t.slice(0,-7)):t.endsWith("Nonpassive")?(o=!1,t=t.slice(0,-10)):t.endsWith("Once")&&(c=!0,t=t.slice(0,-4));const i=(r||!o||c)&&{capture:r,passive:o,once:c};return e.addEventListener(t,n,i),[t,n,i]}(e,n.slice(2),r))}else if(n in e)try{e[n]=r}catch{e.setAttribute(n,r)}else e.setAttribute(n,r)},D=function(e,t){let n,{owner:r}=t;if(!r)throw e;for(;(!(n=r.desc)||!n.catch)&&r.owner;)r=r.owner;r.error=e,U(r)},O=function(t,n,r,o){const i=typeof t;if("string"===i)return[e.createTextNode(t)];if("number"===i)return[e.createTextNode(t+"")];if(t){if(u(t)&&t.length)return t.flat(1/0).map(e=>O(e,n,r,o)).flat();if(x(t)){const{type:i,desc:s,props:l}=t;if(t.ownerNode=r,t.owner=o,!s){t.events=new c;const n=l.xmlns?e.createElementNS(l.xmlns,i):e.createElement(i);return a(l).forEach(e=>{j(n,t,e,l[e])}),t.output=[],t.nodes=[n],[n]}{const e=t.store=B();s.state&&t.store.bind(t,s.state),t.context=n,s.context&&n.bind(t,s.context);try{return t.active=!1,s.init&&s.init.call(t,l,e,n),t.nodes=O(t.output=w(s.render.call(t,l,e,n)).flat(1/0),n,r,t)}catch(o){if(s.catch)return t.nodes=O(t.output=w(s.catch.call(t,o,l,e,n)).flat(1/0),n,r,t);D(o,t)}finally{t.active=!0}}}}return[e.createTextNode("")]},F=function(e){const{desc:t,output:n,nodes:r,owner:o,ownerNode:c,context:i,props:s,store:l,error:f}=e,u=n.length,p=o&&o.nodes;let y=[].concat(r);try{if(e.active=!1,f)throw e.error=void 0,f;const o=c.childNodes;let p,m,E,_,C,H,j,F,k=0;(e.output=w(t.render.call(e,s,l,i)).flat(1/0)).forEach((t,s)=>{if(s<u){if(p=n[s],_=1,x(p)){if(_=(E=p.nodes).length,x(t)&&p.type===t.type){if(p.desc)return b(t,p),U(t),void(k+=t.nodes.length);if(j=a(H=t.props),a(m=p.props).every(e=>j.includes(e)))return k++,b(t,p),patch(E[0],t,H,m,j)}A(p)}else if(!x(t)&&J.cmp(p,t))return;C=O(t,i,c,e),E=d.apply(y,[y.indexOf(r[k]),_].concat(C)),k+=_,N(c,E,C)}else s===u&&(F=o[g.call(o,y[y.length-1])+1]||null),h.apply(y,C=O(t,i,c,e)),c.insertBefore(v(C),F)})}catch(o){t.catch?(y=O(e.output=w(t.catch.call(e,o,s,l,i)),i,c,e),N(c,r,y),n.forEach(e=>{x(e)&&A(e)})):D(o,e)}finally{e.active=!0}if(p){const e=r[0],t=[r.length].concat(y);let n=o,c=p;for(;n;)c=n.nodes,d.apply(c,[c.indexOf(e)].concat(t)),n=n.owner}e.nodes=y},k=[],L=[],W=[];let I=!1;const P=function(){I=!1;const e=Date.now()+J.frameLimit;let t,n;for(n=0;n<k.length;n++)if(t=k[n]){k[n]=void 0;try{F(t)}catch(e){throw k.splice(0,n+1),e}if(Date.now()>=e)return k.splice(0,n+1),S()}for(k.length=0,n=0;n<W.length;n++)if(W[n](),Date.now()>=e)return W.splice(0,n+1),S();for(W.length=0,n=0;n<E.length;n++)if(E[n](),Date.now()>=e)return E.splice(0,n+1),S();for(E.length=0,n=0;n<L.length;n++)if(L[n](),Date.now()>=e)return L.splice(0,n+1),S();L.length=0},S=function(){J.tick(P),I=!0},T=function(){I||S()},U=function(e){k.includes(e)||(T(),k.push(e))},B=function(){const e=new c,t=new c,n=new c,r={map:e,bind(e,n){return n.forEach(n=>{t.has(n)?t.get(n).push(e):t.set(n,[e])}),this},get:function store_get(t){return e.get(t)},set:function store_set(n,o,c){return!c&&J.cmp(o,r.get(n))||(e.set(n,o),t.has(n)&&t.get(n).forEach(e=>{e.active&&U(e)})),r},setter:function store_setter(e,t){const o=+!t;if(n.has(e)){const c=n.get(e),i=c[o];return i||(c[o]=function setter(n){r.set(e,n,t)})}{const c=[];return n.set(e,c),c[o]=function setter(n){r.set(e,n,t)}}},toggle:function store_toggle(e){return r.set(e,!r.get(e))},inc:function store_inc(e,t=1){return r.set(e,r.get(e)+t)},push:function store_push(e,...t){return r.set(e,r.get(e).concat(t))},unshift:function store_unshift(e,...t){return r.set(e,t.concat(r.get(e)))},slice:function store_slice(e,t,n){return r.set(e,r.get(e).slice(t,n))},splice:function store_splice(e,t,n,...o){const c=r.get(e).slice();return d.apply(c,[t,n].concat(o)),r.set(e,c)}};return r},q=m("HUI.Portal",{init:function portal_init(t,n){n.set("parent",t.parent||e.body),n.set("fragment",J(J.Fragment,null,t.children))},render:function portal_render(e,t,n){_(t.get("fragment"),{parent:t.get("parent"),owner:this,context:n})},clear:function portal_clear(e,t){const n=t.get("fragment"),{ownerNode:r,nodes:o}=n;A(n),o.forEach(e=>{r.removeChild(e)}),o.length=0}}),M=m("HUI.Context",{init:function context_init(e,t,n){n.set(e.key,e.value)},render:function context_render(e){return e.children}}),z=function(e,t){if(f(e,t))return!0;if(u(e))return u(t)&&e.length===t.length&&e.every((e,n)=>z(t[n],e));if(e&&t&&"object"==typeof e&&"object"==typeof t){if(e.isHNode)return t.isHNode&&e.type===t.type&&z(e.props,t.props);if(!(e instanceof i||t instanceof i)){const n=a(e),r=a(t);return n.length===r.length&&n.every(n=>r.includes(n)&&z(e[n],t[n]))}}return!1},G=m("HUI.Fragment",{render:function fragment_render(e){return e.children}}),J=(e,t,...n)=>({isHNode:!0,type:e,desc:y.get(e),props:l({children:n.flat(1/0)},t),active:!0});J.registry=y,J.define=m,J.createStore=B,J.propHandlers=H,J.noCmpProps=C,J.render=_,J.tick=function(e){requestAnimationFrame(e)},J.frameLimit=15,J.defer=function(e,...t){L.push(function(){e(...t)}),T()},J.Portal=q,J.Context=M,J.Fragment=G,J.cmp=z;export default J;